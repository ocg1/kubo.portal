package mx.com.kubo.managedbeans;

import java.text.NumberFormat;
import java.util.List;
import java.util.Locale;

import javax.el.ELContext;
import javax.el.ELResolver;
import javax.faces.bean.ManagedProperty;
import javax.faces.context.FacesContext;

import mx.com.kubo.bean.SimBeanForList;
import mx.com.kubo.model.Frequency;
import mx.com.kubo.model.Membership;
import mx.com.kubo.model.MembershipPK;
import mx.com.kubo.model.PrevencionLD;
import mx.com.kubo.model.Prospectus;
import mx.com.kubo.model.ProyectLoan;
import mx.com.kubo.model.Purpose;
import mx.com.kubo.model.SimulationConfig;
import mx.com.kubo.portal.simulador.CATCalculatorIMO;
import mx.com.kubo.portal.simulador.CreditSimulatorIMO;
import mx.com.kubo.portal.simulador.SAFICuotaCreditoIMO;
import mx.com.kubo.repositories.ServiceCallingDao;
import mx.com.kubo.services.Change_controlService;
import mx.com.kubo.services.FrequencyService;
import mx.com.kubo.services.MembershipService;
import mx.com.kubo.services.PrevencionLDService;
import mx.com.kubo.services.ProyectLoanService;
import mx.com.kubo.services.ProyectService;
import mx.com.kubo.services.PurposeService;
import mx.com.kubo.services.SimulationCacheService;
import mx.com.kubo.services.SimulationConfigService;
import mx.com.kubo.services.SimulatorService;
import mx.com.kubo.services.SystemParamService;

import org.apache.log4j.Logger;

public abstract class SimulatorDMO 
implements SimulatorIMO
{
	@ManagedProperty("#{frequencyServiceImp}")
	protected FrequencyService frequencyService;
	
	@ManagedProperty("#{purposeServiceImp}")
	protected PurposeService purposeService;
	
	@ManagedProperty("#{simulatorServiceImp}")
	protected SimulatorService simulatorService;
	
	@ManagedProperty("#{serviceCallingDaoImp}")
	protected ServiceCallingDao servicecallingRepository;
	
	@ManagedProperty("#{prevencionLDServiceImp}")
	protected PrevencionLDService prevencionldservice;
	
	@ManagedProperty("#{change_controlServiceImp}")
	protected Change_controlService changeControlService;
	
	@ManagedProperty("#{systemParamServiceImp}")
	protected SystemParamService systemparamservice;
	
	@ManagedProperty("#{membershipServiceImp}")
	protected MembershipService membershipservice;
	
	@ManagedProperty("#{proyectLoanServiceImp}")
	protected ProyectLoanService proyectLoanService;
	
	@ManagedProperty("#{proyectServiceImp}")
	protected ProyectService proyectService;
	
	@ManagedProperty("#{simulationConfigServiceImp}")
	protected SimulationConfigService simulationConfigService;
	
	@ManagedProperty("#{simulationCacheServiceImp}")
	protected SimulationCacheService simulationCacheService;	
	
	protected FacesContext faces;
	protected ELContext    elContext;
	protected ELResolver   resolver;
	
	protected ProyectLoan      proyectLoan;
	protected MembershipPK     membershipPK;
	protected Membership       membership;
	protected SimulationConfig simulationConfig;
	
	protected TablaAmortizacion amortization;
	
	protected  CreditSimulatorIMO credit_simulator;
	protected    CATCalculatorIMO CAT_calculator;
	protected SAFICuotaCreditoIMO SAFI_cuota_credito;
	
	protected List<Frequency> listFrequencyTmp;
	
	protected String ammountStr   = "50,000";
	protected String totalRecibir = "0";	
	protected String purposeName;
	protected String frequencyName;
	protected String guardarAction;
	protected String mailAction;
	
	protected SimBeanForList simulador_A;
	protected SimBeanForList simulador_C;
	protected SimBeanForList simulador_E;
	
	protected Double comisionApertura = 5D;
	
	protected int frequency_id = 4;
	protected int purpose_id;
	
	protected boolean flagSaveSimulationCache = false;
	
	private Prospectus prospectus;
	protected SessionBean sesion ;
	protected PrevencionLD prevencionld;
	private Purpose purpose     = new Purpose();
	protected Frequency frequency = new Frequency();
	
	protected Logger log = Logger.getLogger(getClass());
	public  Locale locale = new Locale("es","mx");
	public  NumberFormat dec = NumberFormat.getCurrencyInstance(locale);
	
	protected List<SimBeanForList> lstSim;
	protected List<Purpose>        listPurpose;
	protected List<Frequency> listFrequency;
	
	protected String freqStr;
	private String totalPagarStr="0";
	private String montoCuotaStr="0";
	private String ivaInteresStr="0";
	private String interesStr="0";
	private String tableAmort;
	private String catStr="0";
	protected String frequencyStr="0";
	protected String frequencyStr2="0";
	protected String partnerID = null;
	protected String area = null;
	private String fechaInicio;
	private String montoMax;
	private String montoMin;
	private String termMax;
	private String loanTypeID = null;
	
	protected Double tasaTotal=52.6d;  /////////////////////////////////  TASA  TOTAL
	private Double iva=0.16d;
	private Double ivaInteres=0d;
	protected Double interes=0d;
	protected Double totalPagar=0d;
	protected Double tasaPeriodo=0d;
	private Double tasaPeriodoPorc=0d;
	private Double tasaCalculada=0d;
	private Double tasaEfectivaAnual=0d;	
	protected Double cat;
	private Double montoComisionApert;
	protected Double montoCuota=0d;
		
	protected double ammount =50000;
	
	protected int frequencyAnual=12;
	protected int term_id =12;
	private int wsim;
	private int wgral;
	private int wcat;
	private int msim;
	protected int numCuota=0;
	protected int diasFreq = 0;
	private boolean hasPLD;	
	
	protected final int SEMANAL    = 1;
	protected final int CATORCENAL = 2;
	protected final int QUINCENAL  = 3;
	protected final int MENSUAL    = 4;

	public void setMembershipservice(MembershipService service) 
	{
		membershipservice = service;
	}

	public void setSimulationCacheService(SimulationCacheService service) 
	{
		simulationCacheService = service;
	}

	public void setSystemparamservice(SystemParamService service) 
	{
		systemparamservice = service;
	}
	
	public void setServicecallingRepository(ServiceCallingDao service) 
	{
		this.servicecallingRepository = service;
	}
	
	public void setPrevencionldservice(PrevencionLDService service) 
	{
		this.prevencionldservice = service;
	}
	
	public void setChangeControlService(Change_controlService service) 
	{
		this.changeControlService = service;
	}

	public void setProyectLoanService(ProyectLoanService service) 
	{
		proyectLoanService = service;
	}
	
	public void setSimulationConfigService(SimulationConfigService service) 
	{
		simulationConfigService = service;
	}

	public void setPurposeService(PurposeService service) 
	{
		purposeService = service;
	}
	
	public void setFrequencyService(FrequencyService service) 
	{
		frequencyService = service;
	}

	public void setSimulatorService(SimulatorService service) 
	{
		simulatorService = service;
	}
	
	public void setProyectService(ProyectService service) 
	{
		proyectService = service;
	}
	
	public int getWsim() {
		return wsim;
	}

	public void setWsim(int wsim) {
		this.wsim = wsim;
	}

	public int getWgral() {
		return wgral;
	}

	public void setWgral(int wgral) {
		this.wgral = wgral;
	}

	public int getWcat() {
		return wcat;
	}

	public void setWcat(int wcat) {
		this.wcat = wcat;
	}
	
	public int getMsim() {
		return msim;
	}

	public void setMsim(int msim) {
		this.msim = msim;
	}

	public String getMontoMax() {
		return montoMax;
	}

	public void setMontoMax(String montoMax) {
		this.montoMax = montoMax;
	}

	public String getMontoMin() {
		return montoMin;
	}

	public void setMontoMin(String montoMin) {
		this.montoMin = montoMin;
	}

	public String getTermMax() {
		return termMax;
	}

	public void setTermMax(String termMax) {
		this.termMax = termMax;
	}
	
	public Logger getLog() {
		return log;
	}

	public void setLog(Logger log) {
		this.log = log;
	}

	public void setMontoCuotaStr(String montoCuotaStr) 
	{
		this.montoCuotaStr = montoCuotaStr;
	}
	
	public Double getMontoComisionApert() {
		return montoComisionApert;
	}

	public void setMontoComisionApert(Double montoComisionApert) {
		this.montoComisionApert = montoComisionApert;
	}

	public SessionBean getSesion() {
		return sesion;
	}

	public void setSesion(SessionBean sesion) {
		this.sesion = sesion;
	}

	public Locale getLocale() {
		return locale;
	}

	public void setLocale(Locale locale) {
		this.locale = locale;
	}

	public java.text.NumberFormat getDec() {
		return dec;
	}

	public void setDec(java.text.NumberFormat dec) {
		this.dec = dec;
	}

	public void setTotalPagarStr(String totalPagarStr) {
		this.totalPagarStr = totalPagarStr;
	}
	
	public List<SimBeanForList> getLstSim() 
	{	
		return lstSim;
	}

	public void setLstSim(List<SimBeanForList> lstSim) 
	{
		this.lstSim = lstSim;
	}
	
	public String getFrequencyStr2() {
		return frequencyStr2;
	}


	public String getFreqStr() {
		return freqStr;
	}

	public Double getCat() {
		return cat;
	}
	
	public Double getTasaTotal() 
	{	
		if(sesion.getRate() != null && !sesion.getArea().toString().equals("M"))
		{
			tasaTotal = sesion.getRate();
		}
		
		return tasaTotal;
	}

	public String getCatStr() 
	{
		if(getCat() != null)
		{
			catStr = "" + ((double) Math.round((getCat()) * 100) / 100);
		}
		
		return catStr;
	}

	public void setCatStr(String catStr) {
		this.catStr = catStr;
	}
	
	public void setIvaInteresStr(String ivaInteresStr) {
		this.ivaInteresStr = ivaInteresStr;
	}

	public void setInteresStr(String interesStr) {
		this.interesStr = interesStr;
	}
	
	public Double getTasaEfectivaAnual() {
		return tasaEfectivaAnual;
	}

	public void setTasaEfectivaAnual(Double tasaEfectivaAnual) {
		this.tasaEfectivaAnual = tasaEfectivaAnual;
	}
	
	public int getFrequencyAnual() {
		return frequencyAnual;
	}
	
	public String getTableAmort() {
		return tableAmort;
	}

	public void setTableAmort(String tableAmort) {
		this.tableAmort = tableAmort;
	}
	
 	public String getFrequencyStr() 
 	{
		return frequencyStr;
	}
 	
  	public int getNumCuota() 
  	{
		return numCuota;
	}	
  	
 	public String getFechaInicio() 
 	{
		return fechaInicio;
	}

/*
 
	public void setFechaInicio(String fechaInicio) {
		this.fechaInicio = fechaInicio;
	}
 
 	public int getDiasFreq() 
 	{
		return diasFreq;
	}
 
 	public void setCat(Double cat) 
 	{
		this.cat = cat;
	}
 
 	public void setTotalPagar(Double totalPagar) 
 	{
		this.totalPagar = totalPagar;
	}
 
 	public void setMontoCuota(Double montoCuota) 
 	{
		this.montoCuota = montoCuota;
	}
 
 	public void setInteres(Double interes) 
 	{
		this.interes = interes;
	}  
 
 	public void setTasaPeriodo(Double tasaPeriodo) 
 	{
		this.tasaPeriodo = tasaPeriodo;
	}
 
 	public void setNumCuota(int numCuota) 
 	{
		this.numCuota = numCuota;
	}
 
	public void setFrequencyStr(String frequencyStr) {
		this.frequencyStr = frequencyStr;
	}
	
	public void setFrequencyAnual(int frequencyAnual) {
		this.frequencyAnual = frequencyAnual;
	}
	
	public void setFrequencyStr2(String frequencyStr2) 
	{
		this.frequencyStr2 = frequencyStr2;
	}
	
	public void setFrequencyName(String frequencyName) 
	{
		this.frequencyName = getFrequency().getName();
	}
	
	public void setFrequencyName(String frequencyName) 
	{
		this.frequencyName = getFrequency().getName();
	}
	
	public void setDiasFreq(int diasFreq) {
		this.diasFreq = diasFreq;
	}
	
	public void setFreqStr(String freqStr) 
	{
		this.freqStr = freqStr;
	}
*/	

	public Double getTasaPeriodoPorc() {
		return tasaPeriodoPorc;
	}

	public void setTasaPeriodoPorc(Double tasaPeriodoPorc) {
		this.tasaPeriodoPorc = tasaPeriodoPorc;
	}
	
	public boolean isHasPLD() {
		return hasPLD;
	}
	
	public void setHasPLD(boolean hasPLD) {
		this.hasPLD = hasPLD;
	}
	
	public PrevencionLD getPrevencionld() {
		return prevencionld;
	}
	
	public void setPrevencionld(PrevencionLD prevencionld) {
		this.prevencionld = prevencionld;
	}	
	
	public double getAmmount() 
	{
		return ammount;
	}

	public void setAmmount(double ammount) 
	{
		this.ammount = ammount;
	}

	public int getTerm_id() {
		return term_id;
	}

	public void setTerm_id(int term_id) {
		this.term_id = term_id;
	}
	
	public String getLoanTypeID() {
		return loanTypeID;
	}

	public void setLoanTypeID(String loanTypeID) {
		this.loanTypeID = loanTypeID;
	}

	public String getPartnerID() {
		return partnerID;
	}

	public void setPartnerID(String partnerID) {
		this.partnerID = partnerID;
	}

	public String getArea() {
		return area;
	}

	public void setArea(String area) {
		this.area = area;
	}

	public Double getMontoCuota() {
		return montoCuota;
	}

	public Double getTasaPeriodo() {
		return tasaPeriodo;
	}

	public void setTasaTotal(Double tasaTotal) {
		this.tasaTotal = tasaTotal;
	}

	public Double getIva() {
		return iva;
	}

	public void setIva(Double iva) {
		this.iva = iva;
	}

	public Double getInteres() {
		return interes;
	}



	public Double getIvaInteres() {
		return ivaInteres;
	}

	public void setIvaInteres(Double ivaInteres) {
		this.ivaInteres = ivaInteres;
	}
	
	public Double getTotalPagar() {
		return totalPagar;
	}
	
	public Double getTasaCalculada() {
		return tasaCalculada;
	}

	public void setTasaCalculada(Double tasaCalculada) {
		this.tasaCalculada = tasaCalculada;
	}
	
	public Prospectus getProspectus() {
		return prospectus;
	}

	public void setProspectus(Prospectus prospectus) {
		this.prospectus = prospectus;
	}
	
	public Purpose getPurpose() {
		return purpose;
	}

	public void setPurpose(Purpose purpose) {
		this.purpose = purpose;
	}

	public Frequency getFrequency() {
		return frequency;
	}

	public void setFrequency(Frequency frequency) {
		this.frequency = frequency;
	}

	public List<Frequency> getListFrequency() {
		return listFrequency;
	}

	public void setListFrequency(List<Frequency> listFrequency) {
		this.listFrequency = listFrequency;
	}

	public List<Purpose> getListPurpose() {
		return listPurpose;
	}

	public void setListPurpose(List<Purpose> listPurpose) {
		this.listPurpose = listPurpose;
	}
	
	public int getPurpose_id() 
	{
		return purpose_id;
	}
	
	public int getFrequency_id() 
	{
		return frequency_id;
	}
	
	public String getPurposeName()
	{
		return purposeName;
	}
	
	public void setGuardarAction(String guardarAction) 
	{
		this.guardarAction = guardarAction;
	}
	
	public void setMailAction(String mailAction) {
		this.mailAction = mailAction;
	}
	
	public void setSimulador_A(SimBeanForList simulador_A) {
		this.simulador_A = simulador_A;
	}

	public void setSimulador_C(SimBeanForList simulador_C) {
		this.simulador_C = simulador_C;
	}

	public void setSimulador_E(SimBeanForList simulador_E) {
		this.simulador_E = simulador_E;
	}
	
	public SimBeanForList getSimulador_A() {
		return simulador_A;
	}

	public SimBeanForList getSimulador_C() {
		return simulador_C;
	}

	public SimBeanForList getSimulador_E() {
		return simulador_E;
	}
}
